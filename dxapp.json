{
  "name": "pindel",
  "title": "Pindel",
  "summary": "This app implements the Pindel tool (version 0.2.5a) for detection of structural variants (large deletions, medium sized insertions, inversions, tandem duplications, etc). For more information about the Pindel tool, please visit http://gmt.genome.wustl.edu/pindel/0.2.4/index ",
  "dxapi": "1.0.0",
  "version": "0.0.1",
  "categories": [
    "Variation Calling"
  ],
  "inputSpec": [
    {
      "name": "reference_fasta",
      "label": "Reference Genome Sequence (FASTA)",
      "class": "file",
      "patterns": ["*.fa"],
      "optional": false, 
      "group": "App Settings",
      "help": "The reference genome sequences in fasta format. REQUIRED"   
    },
    {
      "name": "fasta_index",
      "label": "FASTA index (from samtools faidx)",
      "class": "file",
      "patterns": ["*.fa.fai"],
      "optional": true, 
      "group": "App Settings",
      "help": "The reference genome index generated by samtools. If not provided, samtools will automatically create an index file. RECOMMENDED"   
    },
    {
      "name": "bam_files",
      "label": "Mappings BAM file",
      "class": "array:file",
      "patterns": ["*.bam"],
      "optional": false, 
      "group": "App Settings",     
      "help": "BAM-file(s) containing mappings you want to search for indels and structural variations. REQUIRED."
    },
    {
      "name": "assume_sorted",
      "label": "Assume Sorted",
      "class": "boolean",
      "default": true,
      "group": "App Settings",     
      "help": "If assume_sorted is set to false AND bam index files are not given as input, app will run samtools sort on input (computationally expensive)"
    },
    {
      "name": "bam_index_files",
      "label": "BAM Index File",
      "class": "array:file",
      "patterns": ["*.bam.bai"],
      "optional": true,
      "group": "App Settings",
      "help": "Provide a BAM index file for each mappings BAM file(s). BAM index file names must match BAM files (ex: file1.bam and file1.bam.bai). If not provided, app will sort (if assume_sorted is set to false) and index mappings BAM file, increasing runtime."
    },
    {
      "name": "bam_config_file",
      "label": "BAM Configuration File",
      "class": "file",
      "optional": true,
      "group": "App Settings",
      "help": "If mappings were generated by BWA/MOSAIK, it is RECOMMENDED to input a bam configuration text file containing the names of the BAM-files one wants to search for indels and structural variations. Pindel performance will be faster with config file. On each line, list the name of the bam-file, the insert size (length of sequence between the paired-end adapters in paired-end sequence), and the label for the sample. Example: \ntumor_sample.bam\t250\tTUMOR"
    },
    {
      "name": "breakdancer_calls_file",
      "label": "Breakdancer (or other SV) Calls File",
      "class": "file",
      "optional": true,
      "group": "Pindel Advanced Settings",
      "help": "Option to include calls from other SV methods such as BreakDancer to further increase sensitivity and specificity. BreakDancer result or calls from any methods must in the format: 'ChrA LocA stringA ChrB LocB stringB other'"
    },
    {
      "name": "optional_files",
      "label": "Optional Input Files",
      "class": "array:file",
      "optional": true,
      "group": "Pindel Advanced Settings",
      "help": "Pindel has command line options to include/exclude sets of regions specified in a bed files, breakdancer, input SV calls for assembly, ploidy, etc (-j <> -J <> -b <> -z <> -Y <>). If you would like to use these options, provide all the files necessary here and type in the command line arguments in 'pindel_advanced_options' app input."
    },
    {
      "name": "insert_size",
      "label": "Expected Average Insert Size",
      "class": "int",
      "optional": true,
      "group": "App Settings",
      "help": "If no bam config file is provided as input to the app, app MUST be given an insert size (the length of sequence between the paired-end adapters in paired-end sequence) and app will automatically create a bam configuration file for pindel to use. If this bam was not produced by BWA, this option will be ignored."
    },
    {
      "name": "bam_not_produced_by_bwa",
      "label": "BAM Not Produced by BWA",
      "class": "boolean",
      "default": false,
      "group": "App Settings",
      "help": "If set as true, sequence_platform MUST ALSO be set as input. Only set as true if a) BAM file was generated by either Illumina-PairEnd or Illumina-MatePair AND IF another aligner than BWA was used to generate bam file. The reads will be converted to pindel input format using sam2pindel.cpp. Sam2pindel expects a mapping location of mate read if the query is unmapped while the mate has been mapped. Users may need to fix the information about mate reads for some mappers such as bowtie."
    },
    {
      "name": "sequence_platform",
      "label": "Sequence Platform",
      "class": "string",
      "optional": true,
      "choices": ["Illumina-MatePair, Illumina-PairEnd"],
      "group": "App Settings",
      "help": "If bam_not_produced_by_bwa is set to true, this input MUST be provided. Pindel's built in sam2pindel conversion takes as input sequence_platform information and supports only Illumina-MatePair or Illumina-PairEnd produced BAM files"
    },
    {
      "name": "output_prefix",
      "label": "Output Prefix",
      "class": "string",
      "optional": true,
      "group": "App Settings",
      "help": "Output Prefix. Default will be the name of the input file"
    },
    {
      "name": "export_vcf",
      "label": "Export as VCF",
      "class": "boolean",
      "default": true,
      "group": "App Settings",    
      "help": "If true, Pindel will ALSO export short insertion, deletion, inversion, and tandem duplication variants as a single VCF file. Long insertion and break point files will be returned as Pindel files (not currently supported by pindel's VCF converter). NOTE: Export GATK Compatible VCF option must also be true if you wish to use VCF files with GATK tools."
    },
    {
      "name": "vcf_gatk_compatible",
      "label": "Export GATK Compatible VCF",
      "class": "boolean",
      "default": false,
      "group": "App Settings",    
      "help": "If TRUE, VCF will also be outputted and the -G (GATK) compatibility option will be used in the pindel2vcf converter and it's possible that this format is not compatible with other VCF-reading software. Also note that GATK requires genotypes to be 0/0, 0/1 or 1/1 instead of undefined, like ./1 or . ('not detected'). However, since pindel cannot yet genotype events (distinguish between 0/1 and 1/1) all events are called as 0/0 (not found) or 0/1, even while some may very well be homozygous alternative (1/1). \nIf FALSE, the -G (GATK) compatibility option will not be used; while this allows Pindel to indicate the uncertainty in genotypes, and should be compatible with most software, this format will not be compatible with GATK pipelines and tools such as GATK ValidateVariants."
    },
    {
      "name": "export_vcf_advanced_options",
      "label": "pindel2vcf Command Line Arguments",
      "class": "string",
      "optional": true,
      "group": "App Settings",
      "help": "If provided, app will run pindel2vcf script with the command line arguments provided as input and export output as VCF file. If not provided, default options and reference genome file name will be used. Please see app page for more details on input parameters. (ex: \"[-P -r -v -G inputs provided by app] -R <required name_and_version_of_reference_genome> -d <required date_of_reference_genome_version>  [-v -c -w -mc -he ... optional parameters]\")"
    },
    {
      "name": "chromosome",
      "label": "Chromosome To Process",
      "class": "string",
      "optional": true,
      "group": "App Settings",
      "help": "Which chr/fragment. Chromosome name must be the same as in reference sequence and in read file. Default (ALL) will loop over all chromosomes. The search for indels and SVs can also be limited to a specific region;\n 20:10,000,000 will only look for indels and SVs after position 10,000,000 == [10M, end] \n-c 20:5,000,000-15,000,000 will report indels in the range between and including the bases at position 5,000,000 and 15,000,000 = [5M, 15M]"
    },
    {
      "name": "num_instances",
      "label": "Number of Instances",
      "class": "int",
      "default": 1,
      "group": "App Settings",
      "help": "The number of subjobs Pindel can be split into. More threads assures lower runtime, but will spawn new instances. NOTE: If report_interchrom_events is True (default behavior) or only one chromosome or region is specified in 'chromosome' input, Pindel will only run on one instance regardless of input."
    },
    {
      "name": "num_threads_per_instance",
      "label": "Number of Threads",
      "class": "int",
      "default": 2,
      "group": "App Settings",
      "help": "The number threads per instance that Pindel will run. More threads assures lower runtime. App is run on DNAnexus default instance types (dx_m1.large) which has 2 processors. If user specifies to run on different instance types, user can change this input"
    },    
    {
      "name": "report_interchrom_events",
      "label": "Report Interchromosomal Events",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings",
      "help": "If true, Pindel will search for and report interchrom events and run only on one instance (regardless of num_instances input)"
    },
    {
      "name": "report_inversions",
      "label": "Report Inversions",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings"
    },
    {
      "name": "report_duplications",
      "label": "Report Tandem Duplications",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings"
    },
    {
      "name": "report_long_insertions",
      "label": "Report Long Insertions",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings",
      "help": "Report insertions of which the full sequence cannot be deduced because of their length"
    },
    {
      "name": "report_read_pair",
      "label": "Report Discordant Read Pair",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings",
      "help": "Search for discordant read-pair to improve sensitivity."
    },
    {
      "name": "report_breakpoints",
      "label": "Report Breakpoints",
      "class": "boolean",
      "default": true,
      "group": "Pindel Advanced Settings"
    },
    {
      "name": "report_close_mapped_reads",
      "label": "Report Close Mapped Reads",
      "class": "boolean",
      "default": false,
      "group": "Pindel Advanced Settings",
      "help": "Report reads of which only one end (the one closest to the mapped read of the paired-end read) could be mapped"
    },
    {
      "name": "report_only_close_mapped_reads",
      "label": "Return ONLY Close Mapped Reads",
      "class": "boolean",
      "default": false,
      "group": "Pindel Advanced Settings",
      "help": "If true, Pindel will not search for SVs and only report reads of which only one end (the one closest to the mapped read of the paired-end read) could be mapped (the output file can then be used as an input file for another run of pindel, which may save size if you need to transfer files). Other files will be outputted as empty files."
    },
    {
      "name": "pindel_command_line",
      "label": "Pindel Advanced Command Line Options",
      "class": "string",
      "optional": true,
      "group": "Pindel Advanced Settings",
      "help": "If specified, pindel will run with the inputed options. App WILL input 'pindel -f <> -p <> -T <> -o <> [and/or -i <>] -r -t -l -k -s -S -I' according to app inputs. Users must input all OTHER command line options i.e. '-c <> -R <> -x <>'. Do not enter inputs already supplied by app."
    }
  ],
  "outputSpec": [   
    {
      "name": "deletions",
      "label": "Pindel Detected Deletions",
      "class": "file"
    },
    {
      "name": "short_inserts",
      "label": "Pindel Detected Short Insertions",
      "class": "file"
    },
    {
      "name": "inversions",
      "label": "Pindel Detected Inversions",
      "class": "file",
      "help": "Output will be empty IF report_inversions (app input) is set to false"
    },
    {
      "name": "tandem_duplications",
      "label": "Pindel Detected Tandem Duplications",
      "class": "file",
      "help": "Output will be empty IF report_duplications (app input) is set to false"
    },
    {
      "name": "large_inserts",
      "label": "Pindel Detected Large Insertions",
      "class": "file",
      "help": "Output will be empty IF report_long_insertions (app input) is set to false"
    },
    {
      "name": "discordant_read_pair",
      "label": "Discordant Read Pair",
      "class": "file",
      "help": "Output will be empty IF report_read_pair (app input) is set to false"
    }, 
    {
      "name": "interchrom_results",
      "label": "Interchromosomal Results",
      "class": "file",
      "help": "Output will be empty if report_interchrom_events (app input) is set to false."
    }, 
    {
      "name": "breakpoints",
      "label": "Pindel Detected Unassigned Breakpoints",
      "class": "file",
      "help": "Output will be empty IF report_breakpoints (app input) is set to false"
    },
    {
      "name": "close_mapped_reads",
      "label": "Pindel Detected Close Mapped Reads",
      "class": "file",
      "optional": true,
      "help": "Output will be empty UNLESS report_close_mapped_reads or report_only_close_mapped_reads (app input) is set to true"
    },
    {
      "name": "breakdancer_outputs",
      "label": "Confirmed Breakdancer Outputs",
      "class": "file",
      "optional": true,
      "help": "If breakdancer input is used, a file will be returned with confirmed breakdancer events with their exact breakpoints to the list of BreakDancer calls with Pindel support information. \nFormat: chr   Loc_left   Loc_right   size   type   index. \nFor example, \"1\t72766323\t72811840\t45516\tD\t11970\" means the deletion event chr1:72766323-72811840 of size 45516 is reported as an event with index 11970 in Pindel report of deletion."
    },    
    {
      "name": "vcf",
      "label": "Pindel Variants (VCF)",
      "class": "file",
      "pattern": ["*.vcf"],
      "optional": true,
      "help": "Output will only be outputed if export_vcf is set to true. Currently pindel2vcf converter does not support large inserts and breakpoint file conversions."
    }, 
	{
      "name": "sortedbam_and_index_files",
      "label": "Sorted BAM Index Files",
      "class": "array:file",
      "optional": true,
      "help": "If app sorts and indexes BAM files, will upload BAM Index(es) [and sorted BAM(s) if assume_sorted=False] to platform for use in future analyses."
    }      
  ],
  "runSpec": {
    "interpreter": "python2.7",
    "file": "src/pindel.py"
  }
}
